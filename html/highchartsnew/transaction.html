<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="m.178hui.com" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="css/transaction.css?v=1"/>
<script src="js/jquery-1.9.1.min.js"></script>
</head>
<body>
<div class="main">
	<div class="title">
		<div class="left_return"  onClick="javascript :history.back(-1);"><img src="img/lefticon.png"/></div>
		<h3>行情</h3>
	</div>
	<div id="app"><!-- 数据列表 -->

	</div>
	<div class="pagebtn">加载更多</div>
</div>
<script>
$(function(){
	var pageNums = 1
	ajax_data(pageNums);
	$(".pagebtn").click(function(){
		pageNums++
		ajax_data(pageNums);
		// console.log(pageNums)
	})
	function ajax_data(pages){
		var api = "https://shop.nainaiwang.com/smallprogram"
			var pageSize = 20
	    $.ajax({
	    	'url':api+"/productOffer/findProductOfferStatisticsNew",
			  'type':'get',
	      'data':{pageNum:pages,pageSize:pageSize,id:""},
	      'datatype':'json',

	         success:function(res){
	        	console.log(pages)
	        	 var str=""//拼接的所有内容
	        	 var strfour=""//差价
			     var prolist = res.data.list//获取数据的数组
			     //console.log(prolist)
	        	  if(prolist !=""){
	        		 $.each(prolist, function(idx,val) {

	        			 var attribute=""//属性
	        			 //判断数据是否大于0
	        			 if(val.disparity>=0){
	        				// console.log(prolist)
	        				 strfour="<div class='tran_four'><b class='rise'>"+Math.abs(val.disparity).toFixed(2)+"</b><img src='img/upicon.png'></img></div>"
	        			 }else if(val.disparity<0){
	        				 strfour="<div class='tran_four'><b class='drop'>"+Math.abs(val.disparity).toFixed(2)+"</b><img src='img/downicon.png'></img></div>"
	        			 }
	        			 //属性拼接内容待开发

	        			 if(val.productAttribute!=null){
		        				var flag1 = false,flag2 = false,flag3 = false,flag4 =false;
		        				var value1,value2,value3,value4;
		        				 var attributeList=val.productAttribute.attributes
		        				 $.each(attributeList, function(proaId,pro){
		        					 if(pro.name=="Fe2O3"){
		        						 flag1 = true;
		        						 value1 = pro.value;
		        					 }
		        					 if(pro.name=="粒度"){
		        						 flag2 = true;
		        						 value2 = pro.value;
		        					 }
		        					 if(pro.name=="Al2o3"){
		        						 flag3 = true;
		        						 value3 = pro.value;
		        					 }
		        					 if(pro.name=="窑炉"){
		        						 flag4 = true;
		        						 value4 = pro.value;
		        					 }
		        				})
		        				if(flag1==true){
		        					attribute+="<div class='parameter'><span>Fe2O3："
		   	 	        				  +value1+"</span></div>"
		        				}else {
		        					attribute+="<div class='parameter'><span>Fe2O3：</span></div>"
	       					 	}
		        				if(flag2==true){
		        					attribute+="<div class='parameter'><span>粒度："
		   	 	        				  +value2+"</span></div>"
			        			}else {
			        				attribute+="<div class='parameter'><span>粒度：</span></div>"
		       					 }
		        				if(flag3==true){
		        					attribute+="<div class='parameter'><span>Al2o3："
		   	 	        				  +value3+"</span></div>"
		        				}else{
		        					attribute+="<div class='parameter'><span>Al2o3：</span></div>"
		        				}
		        				if(flag4==true){
		        					attribute+="<div class='parameter'><span>窑炉："
		   	 	        				  +value4+"</span></div>"
		        				}else{
		        					attribute+="<div class='parameter'><span>窑炉：</span></div>"
		        				}
		        				//console.log(attribute);
		        			 } else if(val.productAttribute==null){
		        				 attribute="<div class='parameter'><span>Fe2O3：</span></div><div class='parameter'><span>粒度：</span></div><div class='parameter'><span>Al2o3：</span></div><div class='parameter'><span>窑炉：</span></div>"
		        			 }
	        			 //拼接数据列表
	        			 str+="<div class='tranlist'><a href='trandetails.html?pages="+pages+"&termporaryName="+val.termporaryName
	        					 +"'><div class='tran_top'><div class='tran_text'><b class='tran_name'>"
	        					 +val.productName+"</b></div><div class='tran_sales'>销售量："
	        					 +val.sum+val.unit+"</div></div><div class='tran_three'><div class='jy_bt'>交易涨幅对比</div><div class='max_price'>最高价：￥"
	        					 +val.max+"/<span class='unit'>"+val.unit+" </span></div></div><div class='tran_three'>"
	        					 +strfour+"<div class='min_price'>最低价：￥"
	        					 +val.min+"/<span class='unit'>"+val.unit+"</span></div></div><div class='tran_two'>"+attribute+"</div></a></div>"
	        		 })

	        		 $("#app").append(str)
	        		 //$(".tran_two").append()
	        	 }
	         }
	    })
	}
})

</script>
</body>
</html>
